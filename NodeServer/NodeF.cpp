// **********************************************************************
// This file was generated by a TAF parser!
// TAF version 8.0.18_20201105184458 by TAF Team.
// Generated from `/Users/jarod/centos/taf-k8s/NodeServer/NodeF.jce'
// **********************************************************************

#include "NodeF.h"
#include "wup-linux-c++/wup.h"
#include "servant/BaseF.h"

using namespace wup;

    namespace taf
    {

        void ServerF::async_response_keepActiving(taf::CurrentPtr current, taf::Int32 _ret)
        {
            if (current->getRequestVersion() == WUPVERSION)
            {
                UniAttribute<taf::BufferWriterVector, taf::BufferReader>  tafAttr;
                tafAttr.put("", _ret);

                current->sendResponse(taf::JCESERVERSUCCESS, tafAttr);
            }
            else
            {
                taf::JceOutputStream<taf::BufferWriterVector> _os;
                _os.write(_ret, 0);

                current->sendResponse(taf::JCESERVERSUCCESS, _os);
            }
        }

        void ServerF::async_response_keepAlive(taf::CurrentPtr current, taf::Int32 _ret)
        {
            if (current->getRequestVersion() == WUPVERSION)
            {
                UniAttribute<taf::BufferWriterVector, taf::BufferReader>  tafAttr;
                tafAttr.put("", _ret);

                current->sendResponse(taf::JCESERVERSUCCESS, tafAttr);
            }
            else
            {
                taf::JceOutputStream<taf::BufferWriterVector> _os;
                _os.write(_ret, 0);

                current->sendResponse(taf::JCESERVERSUCCESS, _os);
            }
        }

        void ServerF::async_response_reportVersion(taf::CurrentPtr current, taf::Int32 _ret)
        {
            if (current->getRequestVersion() == WUPVERSION)
            {
                UniAttribute<taf::BufferWriterVector, taf::BufferReader>  tafAttr;
                tafAttr.put("", _ret);

                current->sendResponse(taf::JCESERVERSUCCESS, tafAttr);
            }
            else
            {
                taf::JceOutputStream<taf::BufferWriterVector> _os;
                _os.write(_ret, 0);

                current->sendResponse(taf::JCESERVERSUCCESS, _os);
            }
        }

        int ServerF::onDispatch(taf::CurrentPtr _current, vector<char> &_sResponseBuffer)
        {
            static ::std::string __taf__ServerF_all[]=
            {
                "keepActiving",
                "keepAlive",
                "reportVersion"
            };

            pair<string*, string*> r = equal_range(__taf__ServerF_all, __taf__ServerF_all+3, _current->getFuncName());
            if(r.first == r.second) return taf::JCESERVERNOFUNCERR;
            switch(r.first - __taf__ServerF_all)
            {
                case 0:
                {
                    taf::JceInputStream<taf::BufferReader> _is;
                    _is.setBuffer(_current->getRequestBuffer());
                    taf::ServerInfo serverInfo;
                    if (_current->getRequestVersion() == WUPVERSION)
                    {
                        UniAttribute<taf::BufferWriterVector, taf::BufferReader>  tafAttr;
                        tafAttr.decode(_current->getRequestBuffer());
                        tafAttr.get("serverInfo", serverInfo);
                    }
                    else if (_current->getRequestVersion() == JSONVERSION)
                    {
                        string buff(_current->getRequestBuffer().begin(), _current->getRequestBuffer().end());
                        taf::JsonValuePtr p = taf::TC_Json::getValue(buff);
                        taf::JsonValueObjPtr pObj = taf::JsonValueObjPtr::dynamicCast(p);
                        taf::JsonInput::readJson(serverInfo, pObj->value["serverInfo"], true);
                    }
                    else
                    {
                        _is.read(serverInfo, 1, true);
                    }
                    taf::Int32 _ret = keepActiving(serverInfo, _current);
                    if(_current->isResponse())
                    {
                        if (_current->getRequestVersion() == WUPVERSION)
                        {
                            UniAttribute<taf::BufferWriterVector, taf::BufferReader>  tafAttr;
                            tafAttr.put("", _ret);
                            tafAttr.encode(_sResponseBuffer);
                        }
                        else if (_current->getRequestVersion() == JSONVERSION)
                        {
                            taf::JsonValueObjPtr p = new taf::JsonValueObj();
                            p->value[""] = taf::JsonOutput::writeJson(_ret);
                            string buff = taf::TC_Json::writeValue(p);
                            _sResponseBuffer.resize(buff.length());
                            _sResponseBuffer.assign(buff.begin(), buff.end());
                        }
                        else
                        {
                            taf::JceOutputStream<taf::BufferWriterVector> _os;
                            _os.write(_ret, 0);
                            _os.swap(_sResponseBuffer);
                        }
                    }
                    return taf::JCESERVERSUCCESS;

                }
                case 1:
                {
                    taf::JceInputStream<taf::BufferReader> _is;
                    _is.setBuffer(_current->getRequestBuffer());
                    taf::ServerInfo serverInfo;
                    if (_current->getRequestVersion() == WUPVERSION)
                    {
                        UniAttribute<taf::BufferWriterVector, taf::BufferReader>  tafAttr;
                        tafAttr.decode(_current->getRequestBuffer());
                        tafAttr.get("serverInfo", serverInfo);
                    }
                    else if (_current->getRequestVersion() == JSONVERSION)
                    {
                        string buff(_current->getRequestBuffer().begin(), _current->getRequestBuffer().end());
                        taf::JsonValuePtr p = taf::TC_Json::getValue(buff);
                        taf::JsonValueObjPtr pObj = taf::JsonValueObjPtr::dynamicCast(p);
                        taf::JsonInput::readJson(serverInfo, pObj->value["serverInfo"], true);
                    }
                    else
                    {
                        _is.read(serverInfo, 1, true);
                    }
                    taf::Int32 _ret = keepAlive(serverInfo, _current);
                    if(_current->isResponse())
                    {
                        if (_current->getRequestVersion() == WUPVERSION)
                        {
                            UniAttribute<taf::BufferWriterVector, taf::BufferReader>  tafAttr;
                            tafAttr.put("", _ret);
                            tafAttr.encode(_sResponseBuffer);
                        }
                        else if (_current->getRequestVersion() == JSONVERSION)
                        {
                            taf::JsonValueObjPtr p = new taf::JsonValueObj();
                            p->value[""] = taf::JsonOutput::writeJson(_ret);
                            string buff = taf::TC_Json::writeValue(p);
                            _sResponseBuffer.resize(buff.length());
                            _sResponseBuffer.assign(buff.begin(), buff.end());
                        }
                        else
                        {
                            taf::JceOutputStream<taf::BufferWriterVector> _os;
                            _os.write(_ret, 0);
                            _os.swap(_sResponseBuffer);
                        }
                    }
                    return taf::JCESERVERSUCCESS;

                }
                case 2:
                {
                    taf::JceInputStream<taf::BufferReader> _is;
                    _is.setBuffer(_current->getRequestBuffer());
                    std::string app;
                    std::string serverName;
                    std::string version;
                    if (_current->getRequestVersion() == WUPVERSION)
                    {
                        UniAttribute<taf::BufferWriterVector, taf::BufferReader>  tafAttr;
                        tafAttr.decode(_current->getRequestBuffer());
                        tafAttr.get("app", app);
                        tafAttr.get("serverName", serverName);
                        tafAttr.get("version", version);
                    }
                    else if (_current->getRequestVersion() == JSONVERSION)
                    {
                        string buff(_current->getRequestBuffer().begin(), _current->getRequestBuffer().end());
                        taf::JsonValuePtr p = taf::TC_Json::getValue(buff);
                        taf::JsonValueObjPtr pObj = taf::JsonValueObjPtr::dynamicCast(p);
                        taf::JsonInput::readJson(app, pObj->value["app"], true);
                        taf::JsonInput::readJson(serverName, pObj->value["serverName"], true);
                        taf::JsonInput::readJson(version, pObj->value["version"], true);
                    }
                    else
                    {
                        _is.read(app, 1, true);
                        _is.read(serverName, 2, true);
                        _is.read(version, 3, true);
                    }
                    taf::Int32 _ret = reportVersion(app,serverName,version, _current);
                    if(_current->isResponse())
                    {
                        if (_current->getRequestVersion() == WUPVERSION)
                        {
                            UniAttribute<taf::BufferWriterVector, taf::BufferReader>  tafAttr;
                            tafAttr.put("", _ret);
                            tafAttr.encode(_sResponseBuffer);
                        }
                        else if (_current->getRequestVersion() == JSONVERSION)
                        {
                            taf::JsonValueObjPtr p = new taf::JsonValueObj();
                            p->value[""] = taf::JsonOutput::writeJson(_ret);
                            string buff = taf::TC_Json::writeValue(p);
                            _sResponseBuffer.resize(buff.length());
                            _sResponseBuffer.assign(buff.begin(), buff.end());
                        }
                        else
                        {
                            taf::JceOutputStream<taf::BufferWriterVector> _os;
                            _os.write(_ret, 0);
                            _os.swap(_sResponseBuffer);
                        }
                    }
                    return taf::JCESERVERSUCCESS;

                }
            }
            return taf::JCESERVERNOFUNCERR;
        }


}

